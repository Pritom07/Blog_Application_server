# Blog_Application_server

âš¡ **A scalable and secure backend engine** powering a modern blogging platform.

Designed with **clean architecture** and **real-world best practices**, this API supports **post management**, **comment workflows**, and **role-based access control** with **enterprise-grade security**.

Crafted using **Node.js**, **TypeScript**, **Express.js**, **Prisma ORM**, **PostgreSQL**, and **better-auth** for **performance**, **reliability**, and **long-term maintainability**.

---

## Features

### Authentication & Authorization

- Secure authentication using **better-auth**
- Token-based authorization
- Role-based access control
  - **Admin** â†’ Full system access
  - **User** â†’ Manage own posts & comments

### Post Management

- Create, update, delete blog posts
- Public post listing with pagination & sorting
- Search posts by keyword & tags
- Featured post support
- View count tracking

### Comment Management

- Add comments to posts
- Update & delete comments (author/admin only)
- Comment status management (e.g. approved / blocked)
- Nested relationship handling via Prisma

### Robust Backend Architecture

- Modular folder structure
- Clear separation of concerns:
  - **Routes â†’ Controllers â†’ Services**
- Centralized global error handling
- Prisma schema split by domain
- Environment-based configuration

---

## Technology Stack

| Layer        | Technology       |
| ------------ | ---------------- |
| Runtime      | Node.js          |
| Language     | TypeScript       |
| Framework    | Express.js       |
| ORM          | Prisma           |
| Database     | PostgreSQL       |
| Auth         | better-auth      |
| Architecture | Modular, layered |

---

## Project Structure

```
Blog_Application_server/
â”œâ”€â”€ generated/
â”œâ”€â”€ node_modules
â”œâ”€â”€ prisma/
â”‚ â”œâ”€â”€ migrations/
â”‚ â””â”€â”€ schema/
â”‚    â”œâ”€â”€ auth.prisma
â”‚    â”œâ”€â”€ posts.prisma
â”‚    â”œâ”€â”€ comments.prisma
â”‚    â””â”€â”€ schema.prisma
â”‚
â”œâ”€â”€ src/
â”‚ â”œâ”€â”€ config/
â”‚ â”‚ â””â”€â”€ index.ts
â”‚ â”‚
â”‚ â”œâ”€â”€ helpers/
â”‚ â”‚ â””â”€â”€ pagination&sortingHelper.ts
â”‚ â”‚
â”‚ â”œâ”€â”€ lib/
â”‚ â”‚ â”œâ”€â”€ auth.ts
â”‚ â”‚ â””â”€â”€ prisma.ts
â”‚ â”‚
â”‚ â”œâ”€â”€ middleware/
â”‚ â”‚ â”œâ”€â”€ auth.ts
â”‚ â”‚ â”œâ”€â”€ globalErrorHandler.ts
â”‚ â”‚ â””â”€â”€ notfound.ts
â”‚ â”‚
â”‚ â”œâ”€â”€ modules/
â”‚ â”‚ â”œâ”€â”€ Posts/
â”‚ â”‚ â”‚ â”œâ”€â”€ posts.routes.ts
â”‚ â”‚ â”‚ â”œâ”€â”€ posts.controllers.ts
â”‚ â”‚ â”‚ â””â”€â”€ posts.services.ts
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Comments/
â”‚ â”‚ â”œâ”€â”€ comments.routes.ts
â”‚ â”‚ â”œâ”€â”€ comments.controllers.ts
â”‚ â”‚ â””â”€â”€ comments.services.ts
â”‚ â”‚
â”‚ â”œâ”€â”€ scripts/
â”‚ â”‚ â””â”€â”€ seedAdmin.ts
â”‚ â”‚
â”‚ â”œâ”€â”€ app.ts
â”‚ â””â”€â”€ server.ts
â”‚
â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ prisma.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

---

## Database Overview

The schema is divided into **authentication-related models** (generated by `better-auth`) and **core domain models** designed specifically for the blogging platform.

This separation ensures **security**, **scalability**, and **clear domain boundaries**.

---

### Authentication Models (better-auth)

These models are automatically managed by **better-auth** and are responsible for user authentication, session handling, and account provider management.

#### User

Represents a registered user in the system.

- `id` â€” Unique identifier
- `name`
- `email` (unique)
- `emailVerified`
- `image`
- `role` â†’ USER | ADMIN
- `status` â†’ ACTIVE | INACTIVE
- `phone`
- `createdAt`
- `updatedAt`

**Relationships**

- One **User** â†’ Many **Sessions**
- One **User** â†’ Many **Accounts**

---

#### Session

Manages authenticated user sessions.

- `id`
- `token` (unique)
- `expiresAt`
- `ipAddress`
- `userAgent`
- `userId`
- `createdAt`
- `updatedAt`

**Relationship**

- Many **Sessions** â†’ One **User**

---

#### Account

Stores external or credential-based authentication providers.

- `id`
- `accountId`
- `providerId`
- `accessToken`
- `refreshToken`
- `idToken`
- `scope`
- `password`
- `accessTokenExpiresAt`
- `refreshTokenExpiresAt`
- `createdAt`
- `updatedAt`

**Relationship**

- Many **Accounts** â†’ One **User**

---

#### Verification

Handles verification workflows such as email or token validation.

- `id`
- `identifier`
- `value`
- `expiresAt`
- `createdAt`
- `updatedAt`

---

### Core Domain Models (Application-Specific)

These models define the **business logic** of the blogging platform and are fully controlled by the application.

---

#### Posts

Represents a blog post created by a user.

- `id`
- `title`
- `content`
- `thumbnail`
- `tags` (array)
- `isFeatured`
- `status` â†’ PUBLISHED | DRAFT | ARCHIVE
- `views`
- `author_Id`
- `created_At`
- `updated_At`

**Relationships**

- One **Post** â†’ Many **Comments**
- One **User** â†’ Many **Posts**

---

#### Comments

Represents user comments on blog posts, including nested replies.

- `id`
- `content`
- `status` â†’ APPROVED | REJECTED
- `author_Id`
- `post_Id`
- `parent_Id` (for nested replies)
- `created_At`
- `updated_At`

**Relationships**

- One **Post** â†’ Many **Comments**
- One **User** â†’ Many **Comments**
- One **Comment** â†’ Many **Replies** (self-referencing)

---

### Relationship Summary

- **User**
  - Has many **Posts**
  - Has many **Comments**
  - Has many **Sessions**
  - Has many **Accounts**

- **Post**
  - Belongs to one **User**
  - Has many **Comments**

- **Comment**
  - Belongs to one **Post**
  - Belongs to one **User**
  - Can have nested **Replies**

---

### Design Considerations

- Referential integrity enforced via Prisma relations
- Cascade deletes ensure orphan-free data
- Enums used for controlled state management
- Authentication models isolated from business logic
- Schema designed for scalability and maintainability

---

## Installation & Setup Instructions

### Clone the Repository

```bash
git clone https://github.com/Pritom07/Blog_Application_server.git
cd Blog_Application_server
```

### Install Dependencies

```bash
npm install
```

### Configure Environment Variables

Create a .env file in the root directory and add the following (for Local development environment):

```env
DATABASE_URL=your_database_connection_string
PORT=300
BETTER_AUTH_SECRET=your_better_auth_secret
BETTER_AUTH_URL=http://localhost:3000
APP_URL=your_frontend_url
APP_USER=your_app_email
APP_PASS=your_app_email_password/secret

GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret

SEED_ADMIN_NAME=admin_name
SEED_ADMIN_EMAIL=admin@example.com
SEED_ADMIN_PASS=secure_password
SEED_ADMIN_ROLE=ADMIN
```

### Run Database Migration

```bash
npx prisma migrate dev --name init
```

### Generate Prisma Client

```bash
npx prisma generate
```

### Seed Admin User

```bash
npm run seed:admin
```

### Start Development Server

```bash
npm run dev
```

## Authentication & Authorization

- Authentication is handled using **better-auth**
- Protected routes require a valid access token
- Role-based authorization is enforced via middleware

---

## Post Endpoints

| Method | Endpoint    | Access                  | Description                                                    |
| ------ | ----------- | ----------------------- | -------------------------------------------------------------- |
| GET    | `/`         | Visitor (Not logged in) | Get all posts                                                  |
| GET    | `/my-posts` | Admin / User            | Get posts created by the currently authenticated user          |
| GET    | `/stats`    | Admin                   | Get post statistics (total posts, views, featured posts, etc.) |
| GET    | `/:id`      | Visitor (Not logged in) | Get a single post by ID                                        |
| POST   | `/`         | Admin / User            | Create a new blog post                                         |
| PATCH  | `/:id`      | Admin / User            | Update an existing post (user or admin only)                   |
| DELETE | `/:id`      | Admin / User            | Delete a post (user or admin only)                             |

### Post Creation & Update Logic

- Only authenticated users can create posts
- A user can update/delete **only their own posts**
- Admin can update/delete **any post**
- Restricted fields (`id`, `views`, `author_Id`, `createdAt`) are protected at service level
- Supports:
  - Tags
  - Featured posts
  - View count tracking
  - Pagination & sorting

---

## Comment Endpoints

| Method | Endpoint      | Access                  | Description                           |
| ------ | ------------- | ----------------------- | ------------------------------------- |
| GET    | `/`           | Visitor (Not logged in) | Get all comments                      |
| GET    | `/:id`        | Visitor (Not logged in) | Get a single comment by ID            |
| GET    | `/author/:id` | Visitor (Not logged in) | Get all comments by a specific user   |
| POST   | `/`           | Admin / User            | Create a new comment                  |
| PATCH  | `/:id`        | Admin / User            | Update a comment (user or admin only) |
| DELETE | `/:id`        | Admin / User            | Delete a comment (user or admin only) |

### Comment Management Rules

- Only authenticated users can create comments
- Users can modify **only their own comments**
- Admin can manage all comments
- Comment status control is enforced in service layer
- Prisma-level validation ensures relational integrity

---

## Business Logic Layer

All core business logic is centralized in the service layer for better maintainability and scalability.

### Service Files

- `posts.services.ts`
- `comments.services.ts`

### Design Principles

- Controllers remain **thin** and handle only the request/response flow
- All **business rules and validations** are handled in the service layer
- Prisma database operations are **abstracted** to keep controllers clean
- Improves **readability, testability, and long-term maintainability**

---

## Error Handling

The application uses a centralized and consistent error-handling strategy.

### ðŸ”¹ Features

- Centralized **global error handler**
- Prisma-specific error mapping for meaningful responses
- Uniform API response structure across all endpoints

### Error Response Format

```json
{
  "success": false,
  "message": "Error description"
}
```
